"use strict";exports.id=543,exports.ids=[543],exports.modules={3543:(e,t,a)=>{a.r(t),a.d(t,{default:()=>x});var n=a(997),s=a(6689),r=a(390),l=a.n(r),o=a(7831);let i="https://quote-api.jup.ag/v6",c=process.env.NEXT_PUBLIC_RPC||"https://api.mainnet-beta.solana.com",d=new o.Connection(c);async function u(e,t,a){let n=`${i}/quote?inputMint=${encodeURIComponent(e)}&outputMint=${encodeURIComponent(t)}&amount=${encodeURIComponent(String(a))}&slippageBps=50`,s=await fetch(n);if(!s.ok)throw Error("Failed to fetch quote");return s.json()}async function p(e,t){let a=await fetch(`${i}/swap`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quoteResponse:t,userPublicKey:e,wrapAndUnwrapSol:!0})});if(!a.ok)throw Error("Failed to fetch swap transaction");let n=await a.json();if(!n)throw Error("Invalid swap response");return n}async function f(e){let t=Buffer.from(e,"base64"),a=await d.sendRawTransaction(t,{skipPreflight:!1});return await d.confirmTransaction(a,"confirmed"),a}var m=a(2707);function x({onClose:e,tokenMint:t,tokenSymbol:a}){let[r,i]=(0,s.useState)(""),[c,d]=(0,s.useState)(!1),[x,h]=(0,s.useState)(null),[w,b]=(0,s.useState)(""),[g,y]=(0,s.useState)("");async function S(){d(!0);try{let e=Math.round(1e9*Number(r)),a=await u("So11111111111111111111111111111111111111112",t,e);h(a)}catch(e){console.error("Quote error",e),alert("Quote failed: "+(e?.message||e))}finally{d(!1)}}async function j(){d(!0);try{let e=null;try{let t=localStorage.getItem("DW_LAST_PW");if(t){let a=await (0,m.wb)(t);a?.pkBase58&&(e=l().decode(a.pkBase58)),!e&&a?.secret&&(e=l().decode(a.secret))}}catch(e){console.warn("decrypt failed",e)}if(!e)try{let t=localStorage.getItem("DW_VAULT_V1");if(t){let a=JSON.parse(t);a?.pkBase58&&(e=l().decode(a.pkBase58)),!e&&a?.secret&&(e=l().decode(a.secret))}}catch(e){}if(!e)return alert("Wallet secret not available. Unlock your wallet first.");let t=e?o.Keypair.fromSecretKey(Uint8Array.from(e)):null,a=await p(t?t.publicKey.toBase58():"unknown",x),n=a?.swapTransaction||a?.data?.swapTransaction;if(!n)throw Error("No swapTransaction returned");if(e){o.Keypair.fromSecretKey(Uint8Array.from(e));try{alert("Auto-sign is experimental. If it fails, the unsigned base64 will be shown for manual signing.")}catch(e){console.warn("Auto-sign attempt failed",e)}}b(""),y(n)}catch(e){console.error("Swap failed",e),alert("Swap failed: "+(e?.message||e))}finally{d(!1)}}async function N(){d(!0);try{let e=localStorage.getItem("DW_LAST_PW"),a=null;if(e)try{let t=await (0,m.wb)(e);a=t?.pubkey}catch(e){}if(!a)try{let e=JSON.parse(localStorage.getItem("DW_VAULT_V1")||"null");a=e?.pubkey||null}catch(e){}if(!a)return alert("Unlock wallet first");let n=Math.round(1e9*Number(r)),s=await fetch("/api/swap/unified",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromToken:"So11111111111111111111111111111111111111112",toToken:t,amount:n,userPubkey:a})}),l=await s.json();if(!l.ok)throw Error(l.error||"Swap failed");alert("Unified swap routed: "+JSON.stringify(l.result).slice(0,200))}catch(e){console.error(e),alert("Unified swap failed: "+(e?.message||e))}finally{d(!1)}}return n.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-[#111] rounded-2xl p-6 w-[90%] max-w-sm text-white",children:[(0,n.jsxs)("h2",{className:"text-lg font-semibold mb-3",children:["Swap SOL → ",a]}),n.jsx("input",{type:"number",placeholder:"Enter amount",value:r,onChange:e=>i(e.target.value),className:"w-full p-3 rounded-lg bg-[#222] mb-3 outline-none text-sm"}),(0,n.jsxs)("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:S,className:"flex-1 bg-[#3B82F6] py-2 rounded-xl font-semibold text-sm",children:c?"Fetching...":"Get Quote"}),x&&n.jsx("button",{onClick:j,className:"flex-1 bg-[#16a34a] py-2 rounded-xl font-semibold text-sm",children:c?"Swapping...":"Swap"})]}),n.jsx("div",{className:"mt-3",children:n.jsx("button",{onClick:N,className:"w-full bg-[#f59e0b] py-2 rounded-xl font-semibold text-sm",children:c?"Routing...":"Unified Swap (auto-router)"})}),x&&(0,n.jsxs)("div",{className:"mt-4 text-xs text-[#aaa]",children:[(0,n.jsxs)("p",{children:["Estimated Output: ",(x?.data?.outAmount||x?.outAmount||0)/1e9]}),(0,n.jsxs)("p",{children:["Price Impact: ",x?.data?.priceImpactPct??x?.priceImpactPct??0,"%"]})]}),w&&(0,n.jsxs)("div",{className:"mt-4 text-xs text-green-500",children:["✅ Swap Successful!",n.jsx("a",{href:`https://solscan.io/tx/${w}?cluster=mainnet`,target:"_blank",rel:"noreferrer",className:"block underline text-blue-400 mt-1",children:"View on Solscan"})]}),g&&(0,n.jsxs)("div",{className:"mt-4 text-xs text-[#ddd]",children:[(0,n.jsxs)("div",{className:"break-words bg-[#0b0b0b] p-2 rounded mb-2 text-[11px]",children:["Unsigned TX (base64): ",g]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>{navigator.clipboard.writeText(g),alert("Copied")},className:"flex-1 bg-[#333] py-2 rounded text-sm",children:"Copy unsigned"}),n.jsx("button",{onClick:async()=>{let e=prompt("Paste signed base64 transaction (if signed externally)");if(e)try{d(!0);let t=await f(e);b(t)}catch(e){alert("Broadcast failed: "+(e?.message||e))}finally{d(!1)}},className:"flex-1 bg-[#3B82F6] py-2 rounded text-sm",children:"Broadcast signed"})]})]}),n.jsx("button",{onClick:e,className:"w-full mt-4 bg-[#333] py-2 rounded-xl text-sm",children:"Close"})]})})}}};