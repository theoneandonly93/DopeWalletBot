"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[543],{3543:function(e,t,a){a.r(t),a.d(t,{default:function(){return x}});var n=a(5893),l=a(7294),o=a(7191),i=a.n(o),s=a(95),r=a(3454),c=a(816).Buffer;let d="https://quote-api.jup.ag/v6",u=r.env.NEXT_PUBLIC_RPC||"https://api.mainnet-beta.solana.com",f=new s.ew(u);async function p(e,t,a){let n="".concat(d,"/quote?inputMint=").concat(encodeURIComponent(e),"&outputMint=").concat(encodeURIComponent(t),"&amount=").concat(encodeURIComponent(String(a)),"&slippageBps=50"),l=await fetch(n);if(!l.ok)throw Error("Failed to fetch quote");return l.json()}async function m(e,t){let a=await fetch("".concat(d,"/swap"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quoteResponse:t,userPublicKey:e,wrapAndUnwrapSol:!0})});if(!a.ok)throw Error("Failed to fetch swap transaction");let n=await a.json();if(!n)throw Error("Invalid swap response");return n}async function h(e){let t=c.from(e,"base64"),a=await f.sendRawTransaction(t,{skipPreflight:!1});return await f.confirmTransaction(a,"confirmed"),a}var w=a(1441);function x(e){var t,a,o,r;let{onClose:c,tokenMint:d,tokenSymbol:u}=e,[f,x]=(0,l.useState)(""),[b,g]=(0,l.useState)(!1),[y,v]=(0,l.useState)(null),[S,k]=(0,l.useState)(""),[N,j]=(0,l.useState)("");async function C(){g(!0);try{let e=Math.round(1e9*Number(f)),t=await p("So11111111111111111111111111111111111111112",d,e);v(t)}catch(e){console.error("Quote error",e),alert("Quote failed: "+((null==e?void 0:e.message)||e))}finally{g(!1)}}async function T(){g(!0);try{var e;let t=null;try{let e=localStorage.getItem("DW_LAST_PW");if(e){let a=await (0,w.wb)(e);(null==a?void 0:a.pkBase58)&&(t=i().decode(a.pkBase58)),!t&&(null==a?void 0:a.secret)&&(t=i().decode(a.secret))}}catch(e){console.warn("decrypt failed",e)}if(!t)try{let e=localStorage.getItem("DW_VAULT_V1");if(e){let a=JSON.parse(e);(null==a?void 0:a.pkBase58)&&(t=i().decode(a.pkBase58)),!t&&(null==a?void 0:a.secret)&&(t=i().decode(a.secret))}}catch(e){}if(!t)return alert("Wallet secret not available. Unlock your wallet first.");let a=t?s.RG.fromSecretKey(Uint8Array.from(t)):null,n=await m(a?a.publicKey.toBase58():"unknown",y),l=(null==n?void 0:n.swapTransaction)||(null==n?void 0:null===(e=n.data)||void 0===e?void 0:e.swapTransaction);if(!l)throw Error("No swapTransaction returned");if(t){s.RG.fromSecretKey(Uint8Array.from(t));try{alert("Auto-sign is experimental. If it fails, the unsigned base64 will be shown for manual signing.")}catch(e){console.warn("Auto-sign attempt failed",e)}}k(""),j(l)}catch(e){console.error("Swap failed",e),alert("Swap failed: "+((null==e?void 0:e.message)||e))}finally{g(!1)}}async function U(){g(!0);try{let e=localStorage.getItem("DW_LAST_PW"),t=null;if(e)try{let a=await (0,w.wb)(e);t=null==a?void 0:a.pubkey}catch(e){}if(!t)try{let e=JSON.parse(localStorage.getItem("DW_VAULT_V1")||"null");t=(null==e?void 0:e.pubkey)||null}catch(e){}if(!t)return alert("Unlock wallet first");let a=Math.round(1e9*Number(f)),n=await fetch("/api/swap/unified",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromToken:"So11111111111111111111111111111111111111112",toToken:d,amount:a,userPubkey:t})}),l=await n.json();if(!l.ok)throw Error(l.error||"Swap failed");alert("Unified swap routed: "+JSON.stringify(l.result).slice(0,200))}catch(e){console.error(e),alert("Unified swap failed: "+((null==e?void 0:e.message)||e))}finally{g(!1)}}return(0,n.jsx)("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-[#111] rounded-2xl p-6 w-[90%] max-w-sm text-white",children:[(0,n.jsxs)("h2",{className:"text-lg font-semibold mb-3",children:["Swap SOL → ",u]}),(0,n.jsx)("input",{type:"number",placeholder:"Enter amount",value:f,onChange:e=>x(e.target.value),className:"w-full p-3 rounded-lg bg-[#222] mb-3 outline-none text-sm"}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)("button",{onClick:C,className:"flex-1 bg-[#3B82F6] py-2 rounded-xl font-semibold text-sm",children:b?"Fetching...":"Get Quote"}),y&&(0,n.jsx)("button",{onClick:T,className:"flex-1 bg-[#16a34a] py-2 rounded-xl font-semibold text-sm",children:b?"Swapping...":"Swap"})]}),(0,n.jsx)("div",{className:"mt-3",children:(0,n.jsx)("button",{onClick:U,className:"w-full bg-[#f59e0b] py-2 rounded-xl font-semibold text-sm",children:b?"Routing...":"Unified Swap (auto-router)"})}),y&&(0,n.jsxs)("div",{className:"mt-4 text-xs text-[#aaa]",children:[(0,n.jsxs)("p",{children:["Estimated Output: ",((null==y?void 0:null===(t=y.data)||void 0===t?void 0:t.outAmount)||(null==y?void 0:y.outAmount)||0)/1e9]}),(0,n.jsxs)("p",{children:["Price Impact: ",null!==(r=null!==(o=null==y?void 0:null===(a=y.data)||void 0===a?void 0:a.priceImpactPct)&&void 0!==o?o:null==y?void 0:y.priceImpactPct)&&void 0!==r?r:0,"%"]})]}),S&&(0,n.jsxs)("div",{className:"mt-4 text-xs text-green-500",children:["✅ Swap Successful!",(0,n.jsx)("a",{href:"https://solscan.io/tx/".concat(S,"?cluster=mainnet"),target:"_blank",rel:"noreferrer",className:"block underline text-blue-400 mt-1",children:"View on Solscan"})]}),N&&(0,n.jsxs)("div",{className:"mt-4 text-xs text-[#ddd]",children:[(0,n.jsxs)("div",{className:"break-words bg-[#0b0b0b] p-2 rounded mb-2 text-[11px]",children:["Unsigned TX (base64): ",N]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(N),alert("Copied")},className:"flex-1 bg-[#333] py-2 rounded text-sm",children:"Copy unsigned"}),(0,n.jsx)("button",{onClick:async()=>{let e=prompt("Paste signed base64 transaction (if signed externally)");if(e)try{g(!0);let t=await h(e);k(t)}catch(e){alert("Broadcast failed: "+((null==e?void 0:e.message)||e))}finally{g(!1)}},className:"flex-1 bg-[#3B82F6] py-2 rounded text-sm",children:"Broadcast signed"})]})]}),(0,n.jsx)("button",{onClick:c,className:"w-full mt-4 bg-[#333] py-2 rounded-xl text-sm",children:"Close"})]})})}}}]);