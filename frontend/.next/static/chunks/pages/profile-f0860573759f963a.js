(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{9134:function(e,l,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return a(7870)}])},7870:function(e,l,a){"use strict";a.r(l),a.d(l,{default:function(){return m}});var s=a(5893),t=a(7294),i=a(1163),n=a(7066),r=a(6469),o=a(2896),c=a(1441),d=a(7751),u=a(3454);function m(){var e,l,a,m;let[x,v]=(0,t.useState)(null),[f,p]=(0,t.useState)(null),[h,b]=(0,t.useState)(null),[j,N]=(0,t.useState)(null),y=(0,i.useRouter)(),w=y.query.username||null,[g,_]=(0,t.useState)(null),[k,S]=(0,t.useState)(!0),[E,D]=(0,t.useState)(!1),[C,F]=(0,t.useState)({display_name:"",username:"",avatar_url:"",bio:""}),[T,A]=(0,t.useState)(!1),[L,P]=(0,t.useState)(!1),U=u.env.NEXT_PUBLIC_BACKEND_URL||"https://dopewalletbot-production.up.railway.app",W=()=>{var e,l,a;let s=null===(e=window.Telegram)||void 0===e?void 0:e.WebApp;return s?(null==s?void 0:null===(a=s.initDataUnsafe)||void 0===a?void 0:null===(l=a.user)||void 0===l?void 0:l.id)||(null==s?void 0:s.initData)&&(()=>{try{var e;return null===(e=JSON.parse(s.initData).user)||void 0===e?void 0:e.id}catch(e){return null}})():null};(0,t.useEffect)(()=>{(async()=>{let e=localStorage.getItem("DW_LAST_PW");if(e){let l=await (0,c.wb)(e);v(l),(null==l?void 0:l.pubkey)&&p(await (0,d.xp)(l.pubkey))}})()},[]),(0,t.useEffect)(()=>{(async()=>{S(!0);try{let e;let l=W();if(w)e=await n.Z.get("".concat(U,"/profile/").concat(w));else if(l)e=await n.Z.get("".concat(U,"/profile/by_telegram/").concat(l));else{_(null),S(!1);return}_(e.data)}catch(l){var e;console.error("Failed to load profile",(null==l?void 0:null===(e=l.response)||void 0===e?void 0:e.data)||l.message||l),_(null)}finally{S(!1)}})()},[w]),(0,t.useEffect)(()=>{var e;(null===(e=y.query)||void 0===e?void 0:e.edit)==="true"&&B()},[y.query]);let B=()=>{F({display_name:(null==g?void 0:g.display_name)||(null==g?void 0:g.username)||"",username:(null==g?void 0:g.username)||"",avatar_url:(null==g?void 0:g.avatar_url)||"",bio:(null==g?void 0:g.bio)||""}),D(!0)},Z=async()=>{try{var e;let l=W();if(!l&&!confirm("Telegram not detected. Save profile locally?"))return;let a={telegramId:l||null,username:C.username,displayName:C.display_name,avatarUrl:C.avatar_url,bio:C.bio},s=await n.Z.post("".concat(U,"/profile/create"),a);(null===(e=s.data)||void 0===e?void 0:e.success)?(_(s.data.profile),D(!1)):alert("Error saving profile")}catch(e){console.error(e),alert("Error saving profile")}},R=async()=>{try{var e,l;P(!0);let a=W();if(!a)return alert("Open inside Telegram to follow users.");let s=await n.Z.post("".concat(U,"/profile/follow"),{follower:a,following:g.username});(null===(e=s.data)||void 0===e?void 0:e.action)==="followed"&&A(!0),(null===(l=s.data)||void 0===l?void 0:l.action)==="unfollowed"&&A(!1)}catch(e){console.error(e),alert("Unable to follow/unfollow")}finally{P(!1)}};return(0,t.useEffect)(()=>{(async()=>{let e=localStorage.getItem("DW_LAST_PW");if(e){let l=await (0,c.wb)(e);v(l),(null==l?void 0:l.pubkey)&&p(await (0,d.xp)(l.pubkey))}})()},[]),(0,s.jsxs)("div",{className:"min-h-screen bg-bg text-white pb-24",children:[(0,s.jsx)(r.Z,{}),(0,s.jsxs)("div",{className:"p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"card bg-card rounded-xl p-4 text-center space-y-3",children:[(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)("div",{className:"avatar",children:(0,s.jsx)("div",{className:"w-16 h-16 rounded-full bg-[#222] flex items-center justify-center",children:(0,s.jsxs)("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[(0,s.jsx)("circle",{cx:"12",cy:"8",r:"3",stroke:"rgba(255,255,255,0.7)",strokeWidth:"1.6",fill:"none"}),(0,s.jsx)("path",{d:"M4 20c1.5-4 6-6 8-6s6.5 2 8 6",stroke:"rgba(255,255,255,0.7)",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})]})})})}),(0,s.jsx)("div",{className:"text-lg font-semibold",children:(null==g?void 0:g.display_name)||(x?"@"+x.pubkey.slice(0,6)+"...":"Anonymous")}),(0,s.jsx)("div",{className:"text-sm text-textDim",children:(null==g?void 0:g.bio)||"The dopest wallet on Solana"}),(0,s.jsxs)("div",{className:"stats stats-vertical sm:stats-horizontal shadow-none bg-transparent p-0",children:[(0,s.jsxs)("div",{className:"stat",children:[(0,s.jsx)("div",{className:"stat-value",children:null!==(a=null==g?void 0:g.followers)&&void 0!==a?a:"-"}),(0,s.jsx)("div",{className:"stat-desc text-textDim",children:"Followers"})]}),(0,s.jsxs)("div",{className:"stat",children:[(0,s.jsx)("div",{className:"stat-value",children:null!==(m=null==g?void 0:g.following)&&void 0!==m?m:"-"}),(0,s.jsx)("div",{className:"stat-desc text-textDim",children:"Following"})]})]}),(0,s.jsxs)("div",{className:"flex justify-center gap-3",children:[(0,s.jsx)("button",{onClick:B,className:"btn btn-primary rounded-xl py-2 px-6 font-semibold text-sm",children:"Edit Profile"}),(0,s.jsx)("button",{disabled:L,onClick:R,className:"btn btn-ghost rounded-xl py-2 px-6",children:T?"Following":"Follow"})]})]}),(0,s.jsxs)("div",{className:"bg-card rounded-xl p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("div",{className:"text-sm font-semibold",children:"Followed Tokens"}),(0,s.jsx)("button",{className:"text-[#3B82F6] text-xs",children:"See All ›"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[null==f?void 0:null===(e=f.tokens)||void 0===e?void 0:e.slice(0,3).map(e=>{var l;return(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("img",{src:e.logo,className:"w-6 h-6 rounded-full",alt:e.symbol}),(0,s.jsx)("div",{className:"text-sm",children:e.symbol})]}),(0,s.jsxs)("div",{className:"text-sm text-textDim",children:["$",(null!==(l=e.price)&&void 0!==l?l:0).toFixed(2)]})]},e.mint)}),!(null==f?void 0:null===(l=f.tokens)||void 0===l?void 0:l.length)&&(0,s.jsx)("div",{className:"text-xs text-textDim text-center py-2",children:"You haven’t followed any tokens yet."})]})]}),(0,s.jsxs)("div",{className:"bg-card rounded-xl p-4 space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("div",{className:"text-sm font-semibold",children:"Recent Activity"}),(0,s.jsx)("button",{className:"text-[#3B82F6] text-xs",children:"View More ›"})]}),(0,s.jsx)("div",{className:"text-xs text-textDim",children:"No recent activity available."})]}),E&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:(0,s.jsxs)("div",{className:"bg-neutral card p-4 w-96",children:[(0,s.jsx)("h3",{className:"font-bold mb-2",children:"Edit Profile"}),(0,s.jsx)("label",{className:"label",children:(0,s.jsx)("span",{className:"label-text",children:"Display name"})}),(0,s.jsx)("input",{className:"input w-full mb-2",value:C.display_name,onChange:e=>F({...C,display_name:e.target.value})}),(0,s.jsx)("label",{className:"label",children:(0,s.jsx)("span",{className:"label-text",children:"Username"})}),(0,s.jsx)("input",{className:"input w-full mb-2",value:C.username,onChange:e=>F({...C,username:e.target.value})}),(0,s.jsx)("label",{className:"label",children:(0,s.jsx)("span",{className:"label-text",children:"Avatar (upload)"})}),(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:async e=>{var l;let a=null===(l=e.target.files)||void 0===l?void 0:l[0];if(!a)return;let s=new FileReader;s.onload=()=>{F(e=>({...e,avatar_url:String(s.result)}))},s.readAsDataURL(a)}}),C.avatar_url&&(0,s.jsx)("img",{src:C.avatar_url,alt:"preview",className:"w-12 h-12 rounded-full object-cover"})]}),(0,s.jsx)("label",{className:"label",children:(0,s.jsx)("span",{className:"label-text",children:"Bio"})}),(0,s.jsx)("textarea",{className:"textarea w-full mb-2",value:C.bio,onChange:e=>F({...C,bio:e.target.value})}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)("button",{className:"btn",onClick:()=>D(!1),children:"Cancel"}),(0,s.jsx)("button",{className:"btn btn-primary",onClick:Z,children:"Save"})]})]})})]}),(0,s.jsx)(o.Z,{})]})}}},function(e){e.O(0,[818,664,717,727,888,774,179],function(){return e(e.s=9134)}),_N_E=e.O()}]);